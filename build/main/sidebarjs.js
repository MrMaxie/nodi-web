!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SidebarJS={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var c="sidebarjs",u="sidebarjs-content",l="".concat(c,"--is-visible"),h="".concat(c,"--is-moving"),p=["left","right"],v={passive:!0},d="touchstart",f="touchmove",m="touchend",y={documentMinSwipeX:10,documentSwipeRange:40,responsive:!1,position:"left",backdropOpacity:.3};function b(){return Boolean(window.CSS&&window.CSS.number)}function S(t){var e=document.createElement("div");return e.setAttribute(t,""),e}function k(t,e){return t&&"boolean"==typeof e?t.sidebarjsListener=e:!!t.sidebarjsListener}function C(t){return t?(t.setAttribute(u,""),t):document.querySelector("[".concat(u,"]"))}function g(t,e){for(var n=["toggle","open","close"],i=0;i<n.length;i++)for(var o=document.querySelectorAll("[".concat(c,"-").concat(n[i],'="').concat(t,'"]')),s=0;s<o.length;s++)e(o[s],n[i])}function O(t){return t.target.hasAttribute("".concat(c,"-backdrop"))}function w(t){t&&t()}var E=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.toggle=function(){e.isVisible()?e.close():e.open()},this.open=function(){e.addComponentClass(l),e.setBackdropOpacity(e.backdropOpacity)},this.close=function(){e.removeComponentClass(l),e.clearStyle(e.backdrop)},this._onTouchStart=function(t){e.initialTouch=t.touches[0].pageX},this._onTouchMove=function(t){var n=-(e.initialTouch-t.touches[0].clientX);e.container.clientWidth+(e.hasLeftPosition()?n:-n)<=e.container.clientWidth&&(e.touchMoveSidebar=Math.abs(n),e.moveSidebar(n))},this._onTouchEnd=function(){e.removeComponentClass(h),e.clearStyle(e.container),e.clearStyle(e.backdrop),e.touchMoveSidebar>e.container.clientWidth/3.5?e.close():e.open(),e.initialTouch=null,e.touchMoveSidebar=null},this._onSwipeOpenStart=function(t){if(!O(t)){var n=t.touches[0].clientX;(e.hasLeftPosition()?n:document.body.clientWidth-n)<e.documentSwipeRange&&e._onTouchStart(t)}},this._onSwipeOpenMove=function(t){if(!O(t)&&e.initialTouch&&!e.isVisible()){var n=t.touches[0].clientX-e.initialTouch,i=e.hasLeftPosition(),o=i?n:-n,s=e.container.clientWidth-o;s>0&&o>=e.documentMinSwipeX&&(e.openMovement=i?-s:s,e.moveSidebar(e.openMovement))}},this._onSwipeOpenEnd=function(){e.openMovement&&(e.openMovement=null,e._onTouchEnd())},this._onTransitionStart=function(){var t=e.getTransitionType(),n=t.open,i=t.close;(n||i)&&e.toggleTransitionClass(!0)},this._onTransitionEnd=function(){var t=e.getTransitionType(),n=t.open,i=t.close,o=t.isVisible;(n||i)&&e.toggleTransitionClass(!1),n?(e._wasVisible=!0,w(e._emitOnOpen)):i&&(e._wasVisible=!1,w(e._emitOnClose)),e._emitOnChangeVisibility&&e._emitOnChangeVisibility({isVisible:o})},this.nativeGestures=new Map([[d,this._onTouchStart],[f,this._onTouchMove],[m,this._onTouchEnd]]),this.nativeOpenGestures=new Map([[d,this._onSwipeOpenStart],[f,this._onSwipeOpenMove],[m,this._onSwipeOpenEnd]]);var o=r(r({},y),i),s=o.container&&o.backdrop;if(this.component=o.component||document.querySelector("[".concat(c,"]")),this.container=s?o.container:S("".concat(c,"-container")),this.backdrop=s?o.backdrop:S("".concat(c,"-backdrop")),this.documentMinSwipeX=o.documentMinSwipeX,this.documentSwipeRange=o.documentSwipeRange,this.nativeSwipe=!1!==o.nativeSwipe,this.nativeSwipeOpen=!1!==o.nativeSwipeOpen,this.isStyleMapSupported=b(),this.responsive=Boolean(o.responsive),this.mainContent=C(o.mainContent),this.backdropOpacity=o.backdropOpacity,this.backdropOpacityRatio=1/o.backdropOpacity,this._emitOnOpen=o.onOpen,this._emitOnClose=o.onClose,this._emitOnChangeVisibility=o.onChangeVisibility,!s)try{this.transcludeContent()}catch(t){throw new Error("You must define an element with [sidebarjs] attribute")}this.setSwipeGestures(!0),(this.responsive||this.mainContent)&&this.setResponsive(),this.setPosition(o.position),this.addAttrsEventsListeners(this.component.getAttribute(c)),this.addTransitionListener(),this.backdrop.addEventListener("click",this.close,v)}return o(t,[{key:"isVisible",value:function(){return this.component.classList.contains(l)}},{key:"destroy",value:function(){var t=this;for(this.removeNativeGestures(),this.container.removeEventListener("transitionstart",this._onTransitionStart),this.container.removeEventListener("transitionend",this._onTransitionEnd),this.backdrop.removeEventListener("click",this.close),this.removeNativeOpenGestures(),this.removeAttrsEventsListeners(this.component.getAttribute(c)),this.removeComponentClassPosition();this.container.firstElementChild;)this.component.appendChild(this.container.firstElementChild);this.component.removeChild(this.container),this.component.removeChild(this.backdrop),Object.keys(this).forEach((function(e){return t[e]=null}))}},{key:"setPosition",value:function(t){var e=this;this.addComponentClass(h),this.position=p.indexOf(t)>=0?t:"left";var n=1===(document.querySelectorAll("[".concat(c,"]"))||[]).length;this.removeComponentClassPosition(n),this.addComponentClass("".concat(c,"--").concat(this.position)),this.responsive&&this.mainContent&&this.mainContent.classList.add("".concat(u,"--").concat(this.position)),setTimeout((function(){return e.component&&e.removeComponentClass(h)}),200)}},{key:"addAttrsEventsListeners",value:function(t){var e=this;g(t,(function(t,n){k(t)||(t.addEventListener("click",e[n],v),k(t,!0))}))}},{key:"removeAttrsEventsListeners",value:function(t){var e=this;g(t,(function(t,n){k(t)&&(t.removeEventListener("click",e[n]),k(t,!1))}))}},{key:"setSwipeGestures",value:function(t){if("boolean"!=typeof t)throw new Error("You provided a ".concat(e(t)," value but setSwipeGestures needs a boolean value."));this.nativeSwipe&&(t?this.addNativeGestures():this.removeNativeGestures(),this.nativeSwipeOpen&&(t?this.addNativeOpenGestures():this.removeNativeOpenGestures()))}},{key:"getTransitionType",value:function(){var t=this.isVisible();return{open:t&&!this._wasVisible,close:!t&&this._wasVisible,isVisible:t}}},{key:"toggleTransitionClass",value:function(t){this.toggleComponentClass("sidebarjs--transition-end",!t),this.toggleComponentClass("sidebarjs--transition-start",t)}},{key:"addTransitionListener",value:function(){this._wasVisible=this.isVisible(),this.container.addEventListener("transitionstart",this._onTransitionStart,v),this.container.addEventListener("transitionend",this._onTransitionEnd,v)}},{key:"removeComponentClassPosition",value:function(t){for(var e=0;e<p.length;e++)this.removeComponentClass("".concat(c,"--").concat(p[e])),t&&this.mainContent&&this.mainContent.classList.remove("".concat(u,"--").concat(p[e]))}},{key:"hasLeftPosition",value:function(){return"left"===this.position}},{key:"hasRightPosition",value:function(){return"right"===this.position}},{key:"transcludeContent",value:function(){for(;this.component.firstChild;)this.container.appendChild(this.component.firstChild);for(;this.component.firstChild;)this.component.removeChild(this.component.firstChild);this.component.appendChild(this.container),this.component.appendChild(this.backdrop)}},{key:"addNativeGestures",value:function(){var t=this;this.nativeGestures.forEach((function(e,n){t.component.addEventListener(n,e,v)}))}},{key:"removeNativeGestures",value:function(){var t=this;this.nativeGestures.forEach((function(e,n){t.component.removeEventListener(n,e)}))}},{key:"addNativeOpenGestures",value:function(){this.nativeOpenGestures.forEach((function(t,e){document.addEventListener(e,t,v)}))}},{key:"removeNativeOpenGestures",value:function(){this.nativeOpenGestures.forEach((function(t,e){document.removeEventListener(e,t)}))}},{key:"moveSidebar",value:function(t){this.addComponentClass(h),this.applyStyle(this.container,"transform","translate(".concat(t,"px, 0)"),!0),this.updateBackdropOpacity(t)}},{key:"updateBackdropOpacity",value:function(t){var e=(1-Math.abs(t)/this.container.clientWidth)/this.backdropOpacityRatio;this.setBackdropOpacity(e)}},{key:"setBackdropOpacity",value:function(t){this.applyStyle(this.backdrop,"opacity",t.toString())}},{key:"setResponsive",value:function(){if(!this.responsive&&this.mainContent)throw new Error("You provide a [".concat(u,"] element without set {responsive: true}"));if(this.responsive&&!this.mainContent)throw new Error("You have set {responsive: true} without provide a [".concat(u,"] element"));this.addComponentClass("sidebarjs--responsive")}},{key:"applyStyle",value:function(t,e,n,i){this.isStyleMapSupported?t.attributeStyleMap.set(e,n):(t.style[e]=n,i&&(t.style["webkit"+e.charAt(0).toUpperCase()+e.slice(1)]=n))}},{key:"clearStyle",value:function(t){this.isStyleMapSupported?t.attributeStyleMap.clear():t.removeAttribute("style")}},{key:"addComponentClass",value:function(t){this.component.classList.add(t)}},{key:"removeComponentClass",value:function(t){this.component.classList.remove(t)}},{key:"toggleComponentClass",value:function(t,e){this.component.classList.toggle(t,e)}}]),t}(),T=function(){function t(){n(this,t),this.instances={}}return o(t,[{key:"fallbackName",value:function(t){return t||""}},{key:"getInstance",value:function(t){return this.instances[this.fallbackName(t)]}},{key:"create",value:function(t){var e,n=this.fallbackName(null==t||null===(e=t.component)||void 0===e?void 0:e.getAttribute(c));return this.instances[n]=new E(t),this.instances[n]}},{key:"open",value:function(t){var e;null===(e=this.getInstance(t))||void 0===e||e.open()}},{key:"close",value:function(t){var e;null===(e=this.getInstance(t))||void 0===e||e.close()}},{key:"toggle",value:function(t){var e;null===(e=this.getInstance(t))||void 0===e||e.toggle()}},{key:"isVisible",value:function(t){var e;return!(null===(e=this.getInstance(t))||void 0===e||!e.isVisible())}},{key:"setPosition",value:function(t,e){var n;null===(n=this.getInstance(e))||void 0===n||n.setPosition(t)}},{key:"elemHasListener",value:function(t,e){return k(t,e)}},{key:"destroy",value:function(t){var e=this.fallbackName(t);this.instances[e]&&(this.instances[e].destroy(),this.instances[e]=null,delete this.instances[e])}}]),t}();t.SidebarElement=E,t.SidebarService=T,Object.defineProperty(t,"__esModule",{value:!0})}));
